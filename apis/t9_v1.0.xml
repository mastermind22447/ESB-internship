<?xml version="1.0" encoding="UTF-8"?>
<api xmlns="http://ws.apache.org/ns/synapse"
     name="Task9API"
     context="/services/training/v1.0/task/9"
     binds-to="default">
   <resource methods="GET" binds-to="default" uri-template="/{categoryId}">
      <inSequence>
         <property name="categoryId" expression="$url:categoryId" scope="default"/>
         <call>
            <endpoint>
               <http method="GET"
                     uri-template="http://localhost:8290/mock/category/{categoryId}"/>
            </endpoint>
         </call>
         <filter source="$body/code" regex=".*">
            <then>
               <payloadFactory media-type="json">
                  <format>
              {
              "errorCode": "$1",
              "errorMessage": "$2"
              }
            </format>
                  <args>
                     <arg evaluator="xml" expression="$body/code"/>
                     <arg evaluator="xml" expression="$body/message"/>
                  </args>
               </payloadFactory>
               <property name="HTTP_SC" value="404" scope="axis2"/>
            </then>
            <else>
               <payloadFactory media-type="json">
                  <format>
              {
              "category": $1
              }
            </format>
                  <args>
                     <arg evaluator="xml" expression="$body"/>
                  </args>
               </payloadFactory>
               <property name="HTTP_SC" value="200" scope="axis2"/>
            </else>
         </filter>
         <property name="messageType" value="application/json" scope="axis2"/>
         <respond/>
      </inSequence>
   </resource>
</api>
